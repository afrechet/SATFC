# Installation instructions

The following instructions are for a fresh install of Ubuntu 20.04 on AWS as of Tuesday, Dec 5, 2023. The instructions should be self-contained, but may be supplemented with the README.md files found both in the root of the project and in the simulator directory. 

- Install Oracle's Java JDK 1.8.301 using the following instructions at https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html. You will need to create an Oracle account. Set your JAVA_HOME variable to point to your new JDK. You should also add this jdk's bin folder to your PATH.
export JAVA_HOME="/home/ubuntu/jdk1.8.0_301/"
export PATH=$PATH:"/home/ubuntu/jdk1.8.0_301/bin"

- git clone https://github.com/newmanne/SATFC.git (contained in this replication folder as SATFC)
- Run `./gradlew installDist` in the root of the SATFC repo
- Install cmake, e.g., via `sudo apt install cmake build-essential`
- Compile SATenstein by first changing directory into SATFC/satfc/src/dist/satenstein and running `./compile.sh`
- Install tbb, e.g., via `sudo apt install libtbb-dev`
- Change directory to SATFC/satfc/src/dist/clasp and run `./compile.sh /usr/include /usr/lib/x86_64-linux-gnu` (or `./compile.sh <TBB_INCLUDE_PATH> <TBB_LIB_PATH>` if your files are located elsewhere) to compile clasp.
- Set the following env variables in your .bashrc<br/>
```
export SATFC=/home/ubuntu/SATFC
export SATFC_SATENSTEIN_LIBRARY=$SATFC/satfc/src/dist/satenstein/jna/libjnasatenstein.so
export SATFC_INTERFERENCE=$SATFC/simulator/src/dist/simulator_data/interference_data
export SATFC_CLASP_LIBRARY=$SATFC/satfc/src/dist/clasp/jna/libjnaclasp.so
```
- Install CPLEX 12.90. Note that CPLEX requires a license that must be acquired through IBM. Set up a variable pointing to CPLEX `export CPLEX_DIR=/home/ubuntu/opt/ibm/ILOG/CPLEX_Studio129/cplex/bin/x86-64_linux`.
- For the plotting code, set up Python and install numpy, pandas, seaborn, tqdm, matplotlib, statsmodels, and humanize. A pip freeze is included in this folder as `py3freeze.txt`. We used Python 3.8.10. 
- Install the `convert` command by running `sudo apt-get install imagemagick`
- Lastly, Figure 9 requires many additional steps for reproduction, as you need to interface with external solvers. You can skip these steps if you do not need to reproduce Figure 9, or if you only care to reproduce the SATFC and Greedy series.
	- If you want to run the Gurobi series, you will need to install it. We used gurobi903. Note that Gurobi requires a license.
	- Install ACLib version 1.2 from https://aclib.net/ (`wget https://aclib.net/data/aclib.tar.gz`) 
	- Note that AClib requires Python 2.7 so install it (e.g., `sudo apt install python2-minimal`)
	- See the file "SATFC/satfc/src/main/java/ca/ubc/cs/beta/stationpacking/solvers/sat/solvers/nonJNISolvers/ACLibSolver.java" and make sure that either `python2` points to your Python 2.7 instance, or else change the string in this file to point to your python accordingly.
	- See SATFC/simulator/src/dist/replication/py2_pip_freeze and install these libraries in the Python 2.7 instance
	- Use AClib to install gnovelty+pcl via `python2 src/install_scenario.py -a gnovelty+PCL`
	- Now navigate to target_algorithms/sat/gnovelty+PCL/callstring_generator.rb and append the following if not present:
```
require 'csv'
in_file = ARGV[0]
in_csv = CSV.read(in_file)
instance_filename = in_csv[0][0]
seed = in_csv[1][0]
param_hashmap = {}
in_csv[2...in_csv.length].each { |x|
	param_hashmap[x[0]] = x[1]
}
call_string = get_solver_callstring(instance_filename, seed, param_hashmap)
puts call_string
```

- Install ruby (we used 2.7.0p0) `sudo apt install ruby-full`
- You will need to move the files satfc_wrapper.py and generic_wrapper_mod.py found at SATFC/simulator/src/dist/scripts/ to the directory your ACLIB_ROOT (where you extracted ACLib)
- In satfc_wrapper.py, change the path of runsolver to be "<ACLIB_ROOT>/target_algorithms/runsolver/runsolver-3.3.4/src/runsolver" 
- Edit the "wrapperPath" found in the files SATFC/satfc/src/dist/bundles/satfc_gnovelty.yaml, SATFC/satfc/src/dist/bundles/cplex.yaml, and SATFC/satfc/src/dist/bundles/gurobi.yaml to point to the wrapper located in ACLIB_ROOT


# Run simulations
- The relevant commands for each simulation needed for the figures can be generated by running the included `SATFC/simulator/src/dist/scripts/replication/commands.py` script. This script generates `commands.txt`, where each line is a command for a simulation. The Python file generates commands arranged by Figure, feel free to comment out certain commands. Run each command.  It will take approximately ***50 CPU years*** to run these simulations; each simulation takes hours to run. We recommend distributing these simulations over a cluster, e.g. using SLURM. We recommend 8 CPUs and 32 GB of RAM per simulation. 

# Make plots
- Run `simulator/src/dist/replication/plots.py`. Change the figure output directory and comment out the code for any figures you don't want to create.